<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100%;
        }

        * {
            box-sizing: border-box;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid #000;
        }

        .header h1 {
            margin: 0 0 15px 0;
            color: #667eea;
            font-size: 2.5em;
            font-weight: 700;
        }

        .header p {
            margin: 5px 0;
            color: #666;
            font-size: 1.1em;
        }

        .nav-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            background: white;
            border: 3px solid #000;
            padding: 15px 30px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Sarabun', sans-serif;
        }

        .nav-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .nav-btn.active {
            background: #667eea;
            color: white;
        }

        .page {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid #000;
        }

        .page.active {
            display: block;
        }

        .page h2 {
            color: #667eea;
            margin-top: 0;
            font-size: 2em;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #000;
            border-radius: 10px;
            font-size: 1em;
            font-family: 'Sarabun', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 3px solid #000;
            padding: 15px 40px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Sarabun', sans-serif;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .student-list {
            margin-top: 30px;
        }

        .student-item {
            background: #f8f9ff;
            border: 2px solid #000;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .student-info {
            flex: 1;
            min-width: 200px;
        }

        .student-info strong {
            color: #667eea;
            font-size: 1.2em;
        }

        .status-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .status-btn {
            padding: 10px 20px;
            border: 2px solid #000;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Sarabun', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
        }

        .status-btn.present {
            background: #4ade80;
        }

        .status-btn.late {
            background: #fbbf24;
        }

        .status-btn.leave {
            background: #60a5fa;
        }

        .status-btn.absent {
            background: #f87171;
        }

        .status-btn.selected {
            transform: scale(1.1);
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 3px solid #000;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }

        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 1.3em;
        }

        .stat-card .number {
            font-size: 3em;
            font-weight: 700;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .stats-table th,
        .stats-table td {
            padding: 15px;
            text-align: left;
            border: 2px solid #000;
        }

        .stats-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .stats-table tr:nth-child(even) {
            background: #f8f9ff;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .nav-bar {
                flex-direction: column;
            }

            .nav-btn {
                width: 100%;
                justify-content: center;
            }

            .student-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .status-group {
                width: 100%;
            }

            .status-btn {
                flex: 1;
            }
        }

        .icon {
            font-size: 1.5em;
        }

        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9ff;
            border: 2px solid #000;
            border-radius: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <p>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå‡∏≠‡∏ô‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</p>
            <p>‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</p>
        </div>

        <div class="nav-bar">
            <button class="nav-btn active" onclick="showPage('dashboard')">
                <span class="icon">üè†</span> ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </button>
            <button class="nav-btn" onclick="showPage('checkin')">
                <span class="icon">‚úÖ</span> ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠
            </button>
            <button class="nav-btn" onclick="showPage('statistics')">
                <span class="icon">üìä</span> ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            </button>
            <button class="nav-btn" onclick="showPage('addstudent')">
                <span class="icon">‚ûï</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            </button>
            <button class="nav-btn" onclick="clearAllData()" style="background: #f87171; color: white;">
                <span class="icon">üóëÔ∏è</span> ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
        </div>

        <div style="text-align: center; margin-bottom: 20px;">
            <span id="connectionStatus" style="padding: 8px 16px; border-radius: 20px; font-weight: 600;">
                üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...
            </span>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
        <div id="dashboard" class="page active">
            <h2>üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>üë• ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <div class="number" id="totalStudents">0</div>
                </div>
                <div class="stat-card">
                    <h3>‚úÖ ‡∏°‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                    <div class="number" id="todayPresent">0</div>
                </div>
                <div class="stat-card">
                    <h3>‚è∞ ‡∏™‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                    <div class="number" id="todayLate">0</div>
                </div>
                <div class="stat-card">
                    <h3>‚ùå ‡∏Ç‡∏≤‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                    <div class="number" id="todayAbsent">0</div>
                </div>
            </div>
            <p style="text-align: center; color: #666; font-size: 1.2em; margin-top: 30px;">
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
            </p>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ -->
        <div id="checkin" class="page">
            <h2>‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
            <div class="form-group">
                <label for="attendanceDate">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                <input type="date" id="attendanceDate">
            </div>
            <div class="form-group">
                <label for="classSelect">üè´ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
                <select id="classSelect" onchange="loadStudentsForAttendance()">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
                    <option value="‡∏°.1/3">‡∏°.1 ‡∏´‡πâ‡∏≠‡∏á 1/3</option>
                    <option value="‡∏°.1/5">‡∏°.1 ‡∏´‡πâ‡∏≠‡∏á 1/5</option>
                    <option value="‡∏°.1/6">‡∏°.1 ‡∏´‡πâ‡∏≠‡∏á 1/6</option>
                </select>
            </div>
            <div id="studentListForAttendance" class="student-list"></div>
            <button class="btn-primary" onclick="saveAttendance()" style="margin-top: 20px;">
                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠
            </button>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
        <div id="statistics" class="page">
            <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
            <div class="form-group">
                <label for="statsClassSelect">üè´ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
                <select id="statsClassSelect" onchange="loadStatistics()">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
                    <option value="‡∏°.1/3">‡∏°.1 ‡∏´‡πâ‡∏≠‡∏á 1/3</option>
                    <option value="‡∏°.1/5">‡∏°.1 ‡∏´‡πâ‡∏≠‡∏á 1/5</option>
                    <option value="‡∏°.1/6">‡∏°.1 ‡∏´‡πâ‡∏≠‡∏á 1/6</option>
                </select>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>‚úÖ ‡∏°‡∏≤</h3>
                    <div class="number" id="statPresent">0</div>
                </div>
                <div class="stat-card">
                    <h3>‚è∞ ‡∏™‡∏≤‡∏¢</h3>
                    <div class="number" id="statLate">0</div>
                </div>
                <div class="stat-card">
                    <h3>üìù ‡∏•‡∏≤</h3>
                    <div class="number" id="statLeave">0</div>
                </div>
                <div class="stat-card">
                    <h3>‚ùå ‡∏Ç‡∏≤‡∏î</h3>
                    <div class="number" id="statAbsent">0</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="statsChart"></canvas>
            </div>
            <table class="stats-table" id="statsTable">
                <thead>
                    <tr>
                        <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                        <th>‡∏°‡∏≤</th>
                        <th>‡∏™‡∏≤‡∏¢</th>
                        <th>‡∏•‡∏≤</th>
                        <th>‡∏Ç‡∏≤‡∏î</th>
                    </tr>
                </thead>
                <tbody id="statsTableBody">
                </tbody>
            </table>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
        <div id="addstudent" class="page">
            <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
            <div class="form-group">
                <label for="studentNumber">üî¢ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</label>
                <input type="number" id="studentNumber" min="1" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà">
            </div>
            <div class="form-group">
                <label for="studentName">üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</label>
                <input type="text" id="studentName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
            </div>
            <div class="form-group">
                <label for="studentClass">üè´ ‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
                <select id="studentClass">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
                    <option value="‡∏°.1/3">‡∏°.1 ‡∏´‡πâ‡∏≠‡∏á 1/3</option>
                    <option value="‡∏°.1/5">‡∏°.1 ‡∏´‡πâ‡∏≠‡∏á 1/5</option>
                    <option value="‡∏°.1/6">‡∏°.1 ‡∏´‡πâ‡∏≠‡∏á 1/6</option>
                </select>
            </div>
            <button class="btn-primary" onclick="addStudent()">
                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            </button>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwA8CnlR8sAutcRsRPBefMHjPNkTtagHqwfWni9ntxDFQ30TlgfFJDQNYXjVRpbOVGrOA/exec';
        
        let students = [];
        let attendance = {};
        let statsChart = null;

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        document.getElementById('attendanceDate').valueAsDate = new Date();

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            event.target.closest('.nav-btn').classList.add('active');

            if (pageId === 'dashboard') {
                updateDashboard();
            } else if (pageId === 'statistics') {
                loadStatistics();
            }
        }

        // ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Local Storage
        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ:', e);
            }
        }

        function loadFromLocalStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ:', e);
                return null;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô JSONP ‡∏û‡∏£‡πâ‡∏≠‡∏° fallback
        function sendDataViaJSONP(data, callback) {
            const callbackName = 'jsonpCallback_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            let timeoutId;
            
            window[callbackName] = function(response) {
                clearTimeout(timeoutId);
                callback(response);
                cleanup();
            };

            function cleanup() {
                if (window[callbackName]) {
                    delete window[callbackName];
                }
                if (script && script.parentNode) {
                    script.parentNode.removeChild(script);
                }
            }

            const params = new URLSearchParams(data);
            params.append('callback', callbackName);
            
            const script = document.createElement('script');
            script.src = SCRIPT_URL + '?' + params.toString();
            
            script.onerror = function() {
                clearTimeout(timeoutId);
                callback({ success: false, message: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ' });
                cleanup();
            };

            // ‡∏ï‡∏±‡πâ‡∏á timeout 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            timeoutId = setTimeout(() => {
                callback({ success: false, message: '‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ' });
                cleanup();
            }, 15000);
            
            document.body.appendChild(script);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö offline
        function workOffline() {
            Swal.fire({
                icon: 'info',
                title: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå',
                text: '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
                confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß'
            });
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        function loadStudents() {
            // ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Local Storage ‡∏Å‡πà‡∏≠‡∏ô
            const localStudents = loadFromLocalStorage('students');
            if (localStudents) {
                students = localStudents;
                updateDashboard();
            }

            // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Google Sheets
            sendDataViaJSONP({ action: 'getStudents' }, function(response) {
                if (response.success) {
                    students = response.data || [];
                    saveToLocalStorage('students', students);
                    updateDashboard();
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Local Storage ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
                    if (!localStudents) {
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                        students = [
                            { number: '1', name: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡πÉ‡∏à ‡πÉ‡∏à‡∏î‡∏µ', class: '‡∏°.1/3' },
                            { number: '2', name: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏Ç‡∏¢‡∏±‡∏ô', class: '‡∏°.1/3' },
                            { number: '3', name: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡∏µ', class: '‡∏°.1/3' },
                            { number: '1', name: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏°‡∏≤‡∏ô‡∏∞', class: '‡∏°.1/5' },
                            { number: '2', name: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏û‡∏£ ‡∏™‡∏∏‡∏Ç‡πÉ‡∏à', class: '‡∏°.1/5' },
                            { number: '1', name: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡∏î‡∏µ‡πÉ‡∏à', class: '‡∏°.1/6' },
                            { number: '2', name: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏§‡∏ó‡∏±‡∏¢ ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', class: '‡∏°.1/6' }
                        ];
                        saveToLocalStorage('students', students);
                        updateDashboard();
                        workOffline();
                    }
                }
            });
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠
        function loadAttendance() {
            // ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Local Storage ‡∏Å‡πà‡∏≠‡∏ô
            const localAttendance = loadFromLocalStorage('attendance');
            if (localAttendance) {
                attendance = localAttendance;
                updateDashboard();
            }

            // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Google Sheets
            sendDataViaJSONP({ action: 'getAttendance' }, function(response) {
                if (response.success) {
                    attendance = response.data || {};
                    saveToLocalStorage('attendance', attendance);
                    updateDashboard();
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Local Storage
                    if (!localAttendance) {
                        attendance = {};
                        saveToLocalStorage('attendance', attendance);
                    }
                }
            });
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        function addStudent() {
            const number = document.getElementById('studentNumber').value;
            const name = document.getElementById('studentName').value;
            const studentClass = document.getElementById('studentClass').value;

            if (!number || !name || !studentClass) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                    confirmButtonText: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á'
                });
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥
            const duplicate = students.find(s => s.number === number && s.class === studentClass);
            if (duplicate) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥',
                    text: '‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                });
                return;
            }

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Local Storage ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            const newStudent = { number: number, name: name, class: studentClass };
            students.push(newStudent);
            saveToLocalStorage('students', students);

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            const data = {
                action: 'addStudent',
                number: number,
                name: name,
                class: studentClass
            };

            sendDataViaJSONP(data, function(response) {
                if (response.success) {
                    Swal.fire({
                        icon: 'success',
                        title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                        text: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                    });
                } else {
                    Swal.fire({
                        icon: 'success',
                        title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                        text: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                    });
                }
                
                document.getElementById('studentNumber').value = '';
                document.getElementById('studentName').value = '';
                document.getElementById('studentClass').value = '';
                updateDashboard();
            });
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠
        function loadStudentsForAttendance() {
            const selectedClass = document.getElementById('classSelect').value;
            const container = document.getElementById('studentListForAttendance');
            
            if (!selectedClass) {
                container.innerHTML = '';
                return;
            }

            const classStudents = students.filter(s => s.class === selectedClass).sort((a, b) => a.number - b.number);
            
            if (classStudents.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ</p>';
                return;
            }

            const date = document.getElementById('attendanceDate').value;
            const dateKey = date || new Date().toISOString().split('T')[0];

            container.innerHTML = classStudents.map(student => {
                const studentKey = `${student.number}_${student.class}`;
                const currentStatus = (attendance[dateKey] && attendance[dateKey][studentKey]) || '';
                
                return `
                    <div class="student-item">
                        <div class="student-info">
                            <strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${student.number}</strong><br>
                            ${student.name}
                        </div>
                        <div class="status-group">
                            <button class="status-btn present ${currentStatus === '‡∏°‡∏≤' ? 'selected' : ''}" 
                                    onclick="setStatus('${studentKey}', '‡∏°‡∏≤', this)">
                                ‚úÖ ‡∏°‡∏≤
                            </button>
                            <button class="status-btn late ${currentStatus === '‡∏™‡∏≤‡∏¢' ? 'selected' : ''}" 
                                    onclick="setStatus('${studentKey}', '‡∏™‡∏≤‡∏¢', this)">
                                ‚è∞ ‡∏™‡∏≤‡∏¢
                            </button>
                            <button class="status-btn leave ${currentStatus === '‡∏•‡∏≤' ? 'selected' : ''}" 
                                    onclick="setStatus('${studentKey}', '‡∏•‡∏≤', this)">
                                üìù ‡∏•‡∏≤
                            </button>
                            <button class="status-btn absent ${currentStatus === '‡∏Ç‡∏≤‡∏î' ? 'selected' : ''}" 
                                    onclick="setStatus('${studentKey}', '‡∏Ç‡∏≤‡∏î', this)">
                                ‚ùå ‡∏Ç‡∏≤‡∏î
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        function setStatus(studentKey, status, button) {
            const date = document.getElementById('attendanceDate').value || new Date().toISOString().split('T')[0];
            
            if (!attendance[date]) {
                attendance[date] = {};
            }
            
            attendance[date][studentKey] = status;

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI
            const parent = button.parentElement;
            parent.querySelectorAll('.status-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠
        function saveAttendance() {
            const date = document.getElementById('attendanceDate').value;
            const selectedClass = document.getElementById('classSelect').value;

            if (!date || !selectedClass) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
                    confirmButtonText: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á'
                });
                return;
            }

            if (!attendance[date] || Object.keys(attendance[date]).length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô',
                    confirmButtonText: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á'
                });
                return;
            }

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Local Storage ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            saveToLocalStorage('attendance', attendance);

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            const data = {
                action: 'saveAttendance',
                date: date,
                class: selectedClass,
                attendance: JSON.stringify(attendance[date])
            };

            sendDataViaJSONP(data, function(response) {
                if (response.success) {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        text: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                    });
                } else {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        text: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                    });
                }
                updateDashboard();
            });
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
        function updateDashboard() {
            document.getElementById('totalStudents').textContent = students.length;

            const today = new Date().toISOString().split('T')[0];
            const todayAttendance = attendance[today] || {};

            let present = 0, late = 0, absent = 0;
            Object.values(todayAttendance).forEach(status => {
                if (status === '‡∏°‡∏≤') present++;
                else if (status === '‡∏™‡∏≤‡∏¢') late++;
                else if (status === '‡∏Ç‡∏≤‡∏î') absent++;
            });

            document.getElementById('todayPresent').textContent = present;
            document.getElementById('todayLate').textContent = late;
            document.getElementById('todayAbsent').textContent = absent;
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        function loadStatistics() {
            const selectedClass = document.getElementById('statsClassSelect').value;
            
            if (!selectedClass) {
                return;
            }

            const classStudents = students.filter(s => s.class === selectedClass).sort((a, b) => a.number - b.number);
            
            const stats = {};
            classStudents.forEach(student => {
                const key = `${student.number}_${student.class}`;
                stats[key] = {
                    number: student.number,
                    name: student.name,
                    present: 0,
                    late: 0,
                    leave: 0,
                    absent: 0
                };
            });

            // ‡∏ô‡∏±‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            Object.values(attendance).forEach(dateData => {
                Object.entries(dateData).forEach(([key, status]) => {
                    if (stats[key]) {
                        if (status === '‡∏°‡∏≤') stats[key].present++;
                        else if (status === '‡∏™‡∏≤‡∏¢') stats[key].late++;
                        else if (status === '‡∏•‡∏≤') stats[key].leave++;
                        else if (status === '‡∏Ç‡∏≤‡∏î') stats[key].absent++;
                    }
                });
            });

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏£‡∏ß‡∏°
            let totalPresent = 0, totalLate = 0, totalLeave = 0, totalAbsent = 0;
            Object.values(stats).forEach(s => {
                totalPresent += s.present;
                totalLate += s.late;
                totalLeave += s.leave;
                totalAbsent += s.absent;
            });

            document.getElementById('statPresent').textContent = totalPresent;
            document.getElementById('statLate').textContent = totalLate;
            document.getElementById('statLeave').textContent = totalLeave;
            document.getElementById('statAbsent').textContent = totalAbsent;

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            const tbody = document.getElementById('statsTableBody');
            tbody.innerHTML = Object.values(stats).map(s => `
                <tr>
                    <td>${s.number}</td>
                    <td>${s.name}</td>
                    <td>${s.present}</td>
                    <td>${s.late}</td>
                    <td>${s.leave}</td>
                    <td>${s.absent}</td>
                </tr>
            `).join('');

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏£‡∏≤‡∏ü
            updateChart(totalPresent, totalLate, totalLeave, totalAbsent);
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏£‡∏≤‡∏ü
        function updateChart(present, late, leave, absent) {
            const ctx = document.getElementById('statsChart').getContext('2d');
            
            if (statsChart) {
                statsChart.destroy();
            }

            statsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['‡∏°‡∏≤', '‡∏™‡∏≤‡∏¢', '‡∏•‡∏≤', '‡∏Ç‡∏≤‡∏î'],
                    datasets: [{
                        label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                        data: [present, late, leave, absent],
                        backgroundColor: [
                            '#4ade80',
                            '#fbbf24',
                            '#60a5fa',
                            '#f87171'
                        ],
                        borderColor: '#000',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏ß‡∏°',
                            font: {
                                size: 18,
                                family: 'Sarabun'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function clearAllData() {
            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                confirmButtonColor: '#f87171'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.clear();
                    students = [];
                    attendance = {};
                    updateDashboard();
                    loadStudentsForAttendance();
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                        text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                    });
                }
            });
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
        function checkConnection() {
            const statusElement = document.getElementById('connectionStatus');
            
            sendDataViaJSONP({ action: 'getStudents' }, function(response) {
                if (response.success) {
                    statusElement.innerHTML = 'üü¢ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
                    statusElement.style.background = '#4ade80';
                    statusElement.style.color = 'white';
                } else {
                    statusElement.innerHTML = 'üî¥ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå';
                    statusElement.style.background = '#f87171';
                    statusElement.style.color = 'white';
                }
            });
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        loadStudents();
        loadAttendance();
        checkConnection();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9958e661e7d47994',t:'MTc2MTYzODQzMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
